<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Acc√®s au guide</title>
</head>
<body>
  <div id="contenu">
    <p>Chargement...</p>
  </div>

  <script>
    (async function () {
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");
      const email = params.get("email");

      const contenu = document.getElementById("contenu");

      if (!token || !email) {
        contenu.innerHTML = "<h2>‚ùå Lien invalide</h2>";
        return;
      }

      try {
        const res = await fetch(`https://script.google.com/macros/s/AKfycbzuL9hxEgTg-z3huQpkhM5pjSiEKZMqWWTfnYLYCZ6fuxMqhbW9aJYc-QtNwcEoyNo/exec?token=${token}&email=${encodeURIComponent(email)}`);
        const data = await res.json();

        if (data.valid) {
          contenu.innerHTML = "<h2>‚úÖ Bienvenue ! Voici votre guide :</h2><p><a href='/le-guide.pdf' target='_blank'>üìò T√©l√©charger le guide</a></p>";
        } else if (data.reason === "expired_or_maxclicks") {
          contenu.innerHTML = "<h2>üïí Lien expir√© ou nombre de clics d√©pass√©</h2>";
        } else {
          contenu.innerHTML = "<h2>‚ùå Lien invalide</h2>";
        }
      } catch (err) {
        contenu.innerHTML = "<h2>‚ö†Ô∏è Erreur de chargement</h2><p>" + err.message + "</p>";
        console.error("Erreur lors du fetch :", err);
      }
    })();
  </script>
</body>
</html>
